"use strict";var app=angular.module("simplicity",["ui.router","ngAnimate"]);app.config(["$stateProvider","$urlRouterProvider","$httpProvider",function(e,t){e.state("main",{url:"",templateUrl:"main/main.html",controller:"MainCtrl",resolve:{featureServiceProperties:["ArcGisServer",function(e){return e.featureService.properties()}]}}).state("main.location",{url:"/:location",template:'<div ui-view style = "z-index : 100" class = "slide"></div>',controller:"LocationCtrl",resolve:{location:["$stateParams",function(e){return e.location}]}}).state("main.location.questions",{url:"/questions",templateUrl:"questions/questions.html",controller:"QuestionsCtrl"}).state("main.location.category",{url:"/:category",templateUrl:"category/category.html",controller:"CategoryCtrl",resolve:{category:["$stateParams",function(e){return e.category}]}}).state("main.location.category.time",{url:"/:time",templateUrl:"time/time.html",controller:"TimeCtrl",resolve:{time:["$stateParams",function(e){return e.time}]}}).state("main.location.category.time.extent",{url:"/:extent",templateUrl:"extent/extent.html",controller:"ExtentCtrl",resolve:{extent:["$stateParams",function(e){return e.extent}]}}).state("main.location.category.time.extent.filter",{url:"/:filter",templateUrl:"filter/filter.html",controller:"FilterCtrl",resolve:{filter:["$stateParams",function(e){return e.filter}]}}).state("main.location.category.time.extent.filter.details",{url:"/:details",templateUrl:"details/details.html",controller:"DetailsCtrl",resolve:{details:["$stateParams",function(e){return e.details}]}}),t.when("/a-zA-Z0-9/",""),t.otherwise("")}]),app.factory("ArcGisServer",["$http","$location","$q","$filter",function(e,t,a){var i={geocodeService:{},geometryService:{},featureService:{},mapService:{}},s={baseServicesUrl:"http://arcgis-arcgisserver1-1222684815.us-east-1.elb.amazonaws.com/arcgis/rest/services",geocodeServiceName:"coa_address_loc",featureServiceName:"opendata"},r={};return i.geocodeService.findAddressCandidates=function(t,i){var r=[s.baseServicesUrl,s.geocodeServiceName,"GeocodeServer","findAddressCandidates"].join("/"),o={"Single Line Input":t,outFields:i,f:"json"},n=a.defer();return e({method:"GET",url:r,params:o,cache:!0}).success(function(e){e.error?console.log(e.error.code+" ArcGisServer.geocodeService.findAddressCanidates "+e.error.message):n.resolve(e)}).error(function(e){console.log("Error gecoding "+t),console.log(e)}),n.promise},i.featureService.properties=function(){var t=a.defer(),i=[s.baseServicesUrl,s.featureServiceName,"FeatureServer"].join("/");return e({method:"GET",url:i,params:{f:"json"},cache:!0}).success(function(e){e.error?console.log(e.error.code+" getFeatureServiceProperties "+e.error.message):(r=e,t.resolve(e))}).error(function(e){console.log("Error getting feature services properties."),console.log(e)}),t.promise},i.featureService.query=function(t,i){var r=[s.baseServicesUrl,s.featureServiceName,"FeatureServer",t,"query"].join("/"),o=a.defer();return e({method:"GET",url:r,params:i,cache:!0}).success(function(e){e.error?console.log(e.error.code+" ArcGisServer.featureService.query on featureServiceId "+t+". "+e.error.message):o.resolve(e)}).error(function(e){console.log("Error querying feature service."),console.log(e)}),o.promise},i.featureService.getId=function(e,t){for(var a=t+"s",i=0;i<r[a].length;i++)if(r[a][i].name===e)return r[a][i].id},i}]),app.factory("LayerDefintion",["$http","$location","$q","$filter","$state","$stateParams",function(e,t,a,i,s,r){var o={},n={crime:{"Aggravated Assault":"FF0000",Burglary:"FFF000","Drug Arrest":"FFFF00",Homicide:"FFFFF0",Larceny:"00FFFF","Larceny of Motor Vehicle":"000080",Rape:"0000FF",Robbery:"FF00FF",Vandalism:"7FFFD4"},development:{"Conditional Use Permit":"FF0000","Conditional Zoning Permit":"FFF000","Planning Level I":"0000FF","Planning Level II":"7FFFD4","Planning Level III":"00FFFF","Planning Signage Plan":"000080"}},l={development:{layer:"coagis.gisowner.coa_opendata_permits",type:"layer",time:"date_opened",filter:"record_type",colors:n.development},"commercial-building":{layer:"coagis.gisowner.coa_opendata_permits",type:"layer",time:"thedate",filter:"record_type",colors:n},crime:{layer:"coagis.gisowner.coa_opendata_crime",type:"layer",time:"thedate",filter:"offense",colors:n.crime},property:{codelinks:{CBD:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-18CEBUDI",CBI:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-12COBUIDI",CBII:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-13COBUIIDI","CBII-CZ":"disable",CI:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-20COINDI",HB:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-16HIBUDI","HB-CZ":"disable",HCU:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTIXOVDI_S7-9-2HIPROVDI","HR-1:CORE":"disable","HR-2:EXPN":"disable","HR-3:CRDR":"disable","HR-4:TRAD":"disable","HR-5:L-W":"disable","HR-6:TOWN":"disable",IND:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-22INDI","IND-CZ":"disable",INST:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-15INDI","INST-CZ":"disable",LI:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-21LIINDI",NB:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-8NEBUDI",NCD:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-24NECODI","NOT ZONED":"disable",O2:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-10OFIIDI",OB:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-11OFBUDI",OFFICE:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-9OFDI",RB:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-17REBUDI","RB-CU":"disable",RESORT:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-14REDI",RIVER:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-19RIDI",RM16:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-7RMREMUMIHIDEDI","RM16-CZ":"disable",RM6:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-5REMUMILODEDI","RM6-CZ":"disable",RM8:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-6REMUMIMEDEDI",RS2:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-2RESIMILODEDI",RS4:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-3RESIMIMEDEDI","RS4-CZ":"disable",RS8:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-4RESIMIHIDEDI","RS8-CZ":"disable",UP:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-26URPLDI","UP-CZ":"disable",URD:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-25URREDI",UV:"https://www.municode.com/library/nc/asheville/codes/code_of_ordinances?nodeId=PTIICOOR_CH7DE_ARTVIIIGEUSDI_S7-8-23URVIDI"}}};return o.colors=function(){return n},o.get=function(e){return l[r.category][e]},o}]),app.controller("CategoryCtrl",["$scope","$stateParams","$state","Category","LocationProperties",function(e,t,a,i,s){e.category=i.getDefinition(t.category),s.properties().then(function(t){e.locationProperties=t}),void 0===t.time,e.goBack=function(){a.go("main.location.questions")}}]),app.factory("Category",["$http","$location","$q","$filter",function(){var e={},t={title:"Crime",defaultStates:{category:"crime",time:"last-year",extent:"within-an-eighth-of-a-mile",filter:"summary",details:"report"}},a={title:"Property",defaultStates:{category:"property",time:"current",extent:"location",filter:"summary",details:"report"}},i={title:"Sanitation",defaultStates:{category:"sanitation",time:"current",extent:"location",filter:"summary",details:"report"}},s={title:"Development",defaultStates:{category:"development",time:"last-year",extent:"within-an-eighth-of-a-mile",filter:"summary",details:"report"}},r={title:"Permits",defaultStates:{category:"permits",time:"last-year",extent:"location",filter:"summary",details:"report"}},o={showTimeOptions:!0,defaultTimeOption:2,showExtentOptions:!1,defaultExtentOption:"neighborhood",showFilterOptions:!1,defaultFilterOption:"summary"},n={cai:{crime:t,property:a,development:s,permits:r,sanitation:i},neighborhood:{crime:o}};return e.getDefinition=function(e){return n.cai[e]},e}]),app.controller("DetailsCtrl",["$scope","$stateParams","$state",function(e,t,a){e.stateParams=t,e.goTo=function(e){a.go("main.location.category.time.extent.filter.details",{details:e})}}]),app.factory("Details",["$http","$location","$q","$filter","$stateParams","ArcGisServer","LayerDefintion","LocationProperties","Time","Extent","Filter",function(e,t,a,i,s,r,o,n,l,c,d){var u={},p={},m=function(e){if("property"===s.category);else{if("crime"===s.category)return"pid in ("+e+")";if("development"===s.category){for(var t="",a=0;a<e.length;a++)t=0===a?t+"'"+e[a]+"'":t+",'"+e[a]+"'";return"apn in ("+t+") and record_module = 'Planning' and record_type_type = 'Development'"}}},g=function(e){var t=a.defer(),i=r.featureService.getId(o.get("layer"),o.get("type")),n=m(e),l={where:n,f:"json",outFields:"*"};return r.featureService.query(i,l).then(function(e){p[s.location]=e,t.resolve(e)}),t.promise},f=function(){var e=new Date,t=e.getTime()-2592e5,a=Math.floor(t/6048e5),i=a%2;return 0==i?"B":"A"};return u.getRecyclingSchedule=function(e){{var t=e.split(" ");f()}return"A)"===t[3]?"A"===f()?{week:"A",when:"this week"}:{week:"A",when:"next week"}:"B"===f()?{week:"B",when:"this week"}:{week:"B",when:"next week"}},u.getBrushSchedule=function(e,t){return"MONDAY"===t||"TUESDAY"===t?"B"===e.week&&"this week"===e.when?{when:"this week"}:{when:"next week"}:"A"===e.week&&"this week"===e.when?{when:"this week"}:{when:"next week"}},u.getPropertyDetails=function(e){var t=a.defer(),i=r.featureService.getId("coagis.gisowner.coa_civicaddress_pinnum_centerline_xref_view","table"),s={where:"civicaddress_id="+e,f:"json",outFields:"*"};return r.featureService.query(i,s).then(function(e){var a=r.featureService.getId("coagis.gisowner.coa_opendata_property","layer"),i={where:"pinnum='"+e.features[0].attributes.pinnum+"'",f:"json",outFields:"*"};r.featureService.query(a,i).then(function(e){e.features[0].attributes.codelinks=o.get("codelinks"),t.resolve(e.features[0])})}),t.promise},u.getZoningOverlays=function(e){var t=e.split("-"),i=a.defer(),s=r.featureService.getId("coagis.gisowner.coa_opendata_zoning_overlays","layer"),o={where:"name='"+t[0]+"'",f:"json",outFields:"*"};return r.featureService.query(s,o).then(function(e){i.resolve(e.features[0])}),i.promise},u.getFilteredDetails=function(){var e=a.defer(),t=s.category;return n.properties().then(function(a){g(a[t][c.filterValue()]).then(function(t){for(var a=o.get("time"),i=o.get("filter"),r=o.get("colors"),n={template:"summary",table:{}},c=[],u=0;u<t.features.length;u++)t.features[u].attributes[a]>=l.filterValue()&&(t.features[u].attributes.color=r[t.features[u].attributes[i]],void 0===n.table[t.features[u].attributes[i]]?n.table[t.features[u].attributes[i]]={color:r[t.features[u].attributes[i]],count:1}:n.table[t.features[u].attributes[i]].count=n.table[t.features[u].attributes[i]].count+1,("summary"===s.filter||t.features[u].attributes[i].toLowerCase().replace(/ /g,"-")===s.filter)&&(t.features[u].template=s.category,c.push(t.features[u]),t.features[u].attributes.record_comments&&(t.features[u].attributes.commentsArray=t.features[u].attributes.record_comments.split("[NEXTCOMMENT]"))));var p=[];p.push({value:"summary",label:"Summary"});for(var m in n.table)p.push({value:m.toLowerCase().replace(/ /g,"-"),label:m});d.options(s.category,p);var g={features:c,summary:n};e.resolve(g)})}),e.promise},u}]),app.controller("ExtentCtrl",["$scope","$stateParams","$state","Extent",function(e,t,a,i){if("location"===t.extent||"neighborhood"===t.extent)e.show=!1;else{e.show=!0,e.extentOptions=i.options();for(var s=0;s<e.extentOptions.length;s++)e.extentOptions[s].value===t.extent&&(e.defaultOption=s)}e.onChangeExtentValue=function(){a.go("main.location.category.time.extent.filter.details",{extent:e.extentValue.value})}}]),app.factory("Extent",["$stateParams",function(e){var t={},a={"within-about-a-block":330,"within-an-eighth-of-a-mile":660,"within-a-quarter-mile":1320},i=[{value:"within-about-a-block",label:"within a city block (110 yards)"},{value:"within-an-eighth-of-a-mile",label:"within a couple city blocks (1/8 of a mile)"},{value:"within-a-quarter-mile",label:"within a quarter mile"}];return t.options=function(e){return void 0===e?i:void(i=e)},t.filterValue=function(){return a[e.extent]},t}]),app.controller("FilterCtrl",["$scope","$stateParams","$state","Filter",function(e,t,a,i){e.filterOptions=i.options(t.category);for(var s=0;s<e.filterOptions.length;s++)e.filterOptions[s].value===t.filter&&(e.defaultOption=s);e.hasFilter=!1,e.show="summary"===t.filter?!1:!0,e.$watch(function(){return i.options(t.category)},function(a){if("property"===t.category||"sanitation"===t.category)e.hasFilter=!1;else if(a.length>1){e.hasFilter=!0,e.filterOptions=a;for(var i=0;i<e.filterOptions.length;i++)e.filterOptions[i].value===t.filter&&(e.filterValue=e.filterOptions[i])}else e.hasFilter=!1},!0),e.onChangeFilterValue=function(){a.go("main.location.category.time.extent.filter.details",{filter:e.filterValue.value})}}]),app.factory("Filter",[function(){var e={},t=[{value:"summary",label:"Property Summary"}],a=[{value:"summary",label:"Crime Summary"}],i=[{value:"summary",label:"Development Summary"}],s=[{value:"summary",label:"Sanitation Summary"}],r={crime:a,property:t,development:i,sanitation:s};return e.options=function(e,t){return t?r[e]=t:r[e]},e}]),app.controller("LocationCtrl",[function(){}]),app.factory("LocationProperties",["$http","$location","$q","$filter","$state","$stateParams","ArcGisServer",function(e,t,a,i,s,r,o){var n={},l={},c=function(e,t,a){l[e]?l[e][t]=a:(l[e]={},l[e][t]=a)},d=function(e,t){return null===e?[]:e.split(t)},u=function(e){var t=a.defer(),i=o.featureService.getId("coagis.gisowner.coa_overlay_data_cache","table"),s={where:"civicaddress_id="+e,f:"json",outFields:"*"};return o.featureService.query(i,s).then(function(e){for(var a=0;a<e.features.length;a++){var i=e.features[a].attributes;if("ADDRESS IN CITY"===i.type)l.inTheCity="YES"===i.data?!0:!1;else if("CRIME"===i.type){var s=d(i.data,",");c("crime",i.distance,s)}else if("ZONING"===i.type)l.zoning=null===i.data?[]:i.data.split(",");else if("PERMITS"===i.type){var s=d(i.data,",");c("development",i.distance,s)}else"TRASH DAY"===i.type?l.sanitation?l.sanitation.trash=i.data:l.sanitation={trash:i.data}:"RECYCLE DAY"===i.type?l.sanitation?l.sanitation.recycling=i.data:l.sanitation={recycling:i.data}:"ZONING OVERLAYS"===i.type&&(l.zoningOverlays=i.data)}t.resolve(l)}),t.promise},p=function(e){var t=a.defer(),i=o.featureService.getId("coagis.gisowner.coa_opendata_address","layer"),s={where:"civicaddress_id="+e,f:"json",outFields:"*"};return o.featureService.query(i,s).then(function(a){var i=a.features[0].attributes,s={address:i.address,location:{x:i.x,y:i.y},score:100,attributes:{Score:100,Match_addr:i.address,House:i.street_number,Side:"",PreDir:"",PreType:i.street_prefix,StreetName:i.street_name,SufType:i.street_type,SufDir:i.street_postdirection,City:"",State:"",ZIP:i.zip_code,Ref_ID:e,User_fld:"",Addr_type:"StreetAddress"}};l.address=s,u(e).then(function(e){t.resolve(e)})}),t.promise};return n.properties=function(e){var t=a.defer();return e?(l.address=e,u(e.attributes.Ref_ID).then(function(e){t.resolve(e)})):l.address?t.resolve(l):r.location?p(r.location).then(function(e){t.resolve(e)}):s.go("main"),t.promise},n}]),app.controller("MainCtrl",["$scope","$state","$stateParams","$location","$http","$timeout","ArcGisServer","LocationProperties",function(e,t,a,i,s,r,o,n){e.typedLocation="",e.addresses=[],e.errorMessage={show:!1,message:"We had trouble locating that location. Please try to enter a location again."},e.helperMessage={show:!1,message:"Please choose one of the options below."},e.getAddressCandidates=function(t,a){13===a.keyCode&&""!==t&&(e.helperMessage.show=!0,r(function(){e.helperMessage.show=!1},2e3)),o.geocodeService.findAddressCandidates(t,"*").then(function(t){e.addresses=t})},e.getLocationProperties=function(a){e.addresses=[],e.typedLocation=a.address,n.properties(a).then(function(){t.go("main.location.questions",{location:a.attributes.Ref_ID})})},e.goHome=function(){i.path("")}}]),app.controller("QuestionsCtrl",["$scope","$state","$stateParams","Category","Questions","LocationProperties",function(e,t,a,i,s,r){var o=[];r.properties().then(function(t){e.locationProperties=t;var a=[];for(var i in t)a.push(i);o=s.get(a),e.questions=o.slice(0,3)}),e.questions=[],e.more={show:!0,get:function(){var t=e.questions.length,a=3;o.length-t<3&&(a=o.length-t);var i=t+a;e.questions=o.slice(0,i),i===o.length&&(this.show=!1)}},e.questions===o.length&&(e.more.show=!1),e.getAnswer=function(a){e.category=i.getDefinition(a.category),t.go("main.location.category.time.extent.filter.details",e.category.defaultStates)}}]),app.factory("Questions",[function(){var e={},t=[{question:"Do you want to know about this property?",category:"property",detail:"summary"}],a={crime:[{question:"Do you want to know about crime?",category:"crime",detail:"within-quarter-mile"}],development:[{question:"Do you want to know about development?",category:"development",detail:"summary"}],zoning:[{question:"Do you want to know about the zoning?",category:"property",detail:"zoning"}],sanitation:[{question:"Do you want to know about trash collection?",category:"sanitation",detail:"summary"},{question:"Do you want to know about recycling collection?",category:"sanitation",detail:"summary"}]};return e.get=function(e){e.sort();for(var i=t,s=0;s<e.length;s++)a[e[s]]&&(i=i.concat(a[e[s]]));return i},e}]),app.controller("TimeCtrl",["$scope","$stateParams","$state","Time",function(e,t,a,i){if("current"===t.time)e.show=!1;else{e.show=!0,e.timeOptions=i.options();for(var s=0;s<e.timeOptions.length;s++)e.timeOptions[s].value===t.time&&(e.defaultOption=s)}e.onChangeTimeValue=function(){a.go("main.location.category.time.extent.filter.details",{time:e.timeValue.value})}}]),app.factory("Time",["$stateParams",function(e){var t={},a=new Date,i={"last-30-days":a.setMonth(a.getMonth()-1),"last-6-months":a.setMonth(a.getMonth()-6),"last-year":a.setFullYear(a.getFullYear()-1),"last-5-years":a.setFullYear(a.getFullYear()-5),"last-10-years":a.setFullYear(a.getFullYear()-10),"all-time":a.setFullYear(a.getFullYear()-100)},s=[{value:"last-30-days",label:"during the last 30 days"},{value:"last-6-months",label:"during the last 6 months"},{value:"last-year",label:"during the last year"},{value:"last-5-years",label:"during the last 5 years"},{value:"last-10-years",label:"during the last 10 years"},{value:"all-time",label:"all time"}];return t.options=function(e){return void 0===e?s:void(s=e)},t.filterValue=function(){return i[e.time]},t}]),function(e){try{e=angular.module("simplicity")}catch(t){e=angular.module("simplicity",[])}e.run(["$templateCache",function(e){e.put("category/category.html",'<div class="row list-item-panel" style="padding : 20px"><div class="col-xs-12"><a ng-click="goBack();">Back to Questions</a></div><div class="col-xs-6"><h3>{{category.title}}</h3></div><div class="col-xs-6"><address class="pull-right" style="margin-top: 12px;"><strong>{{locationProperties.address.attributes.House}} {{locationProperties.address.attributes.preType}} {{locationProperties.address.attributes.StreetName}} {{locationProperties.address.attributes.SufType}} {{locationProperties.address.attributes.SufDir}} <span ng-if="locationProperties.address.attributes.User_fld !== \'\'">UNIT: {{locationProperties.address.attributes.User_fld}}</span></strong><br><span ng-if="locationProperties.inTheCity">Asheville, NC</span> {{locationProperties.address.attributes.ZIP}}</address></div><div ui-view=""></div></div>')}])}(),function(e){try{e=angular.module("simplicity")}catch(t){e=angular.module("simplicity",[])}e.run(["$templateCache",function(e){e.put("details/details.html",'<div class="row"><div ng-if="stateParams.details === \'report\'" report="stateParams"></div><div ng-if="stateParams.details === \'map\'" map="stateParams"></div></div>')}])}(),function(e){try{e=angular.module("simplicity")}catch(t){e=angular.module("simplicity",[])}e.run(["$templateCache",function(e){e.put("extent/extent.html",'<div><div class="form-group col-xs-12" ng-show="show"><select class="form-control" id="extent" ng-init="extentValue = extentOptions[defaultOption]" ng-model="extentValue" ng-options="item.label for item in extentOptions" ng-change="onChangeExtentValue()" style="width : 100%"></select></div><div ui-view=""></div></div>')}])}(),function(e){try{e=angular.module("simplicity")}catch(t){e=angular.module("simplicity",[])}e.run(["$templateCache",function(e){e.put("filter/filter.html",'<div><div ng-show="hasFilter"><a ng-click="show = !show" ng-show="!show">Filter Results</a> <a ng-click="show = !show" ng-show="show">Remove Filter</a><div class="form-group col-xs-12" ng-show="show"><select class="form-control" id="filter" ng-init="filterValue = filterOptions[defaultOption]" ng-model="filterValue" ng-options="item.label for item in filterOptions" ng-change="onChangeFilterValue()" style="width : 100%"></select></div></div><div class="row" ui-view=""></div></div>')}])}(),function(e){try{e=angular.module("simplicity")}catch(t){e=angular.module("simplicity",[])}e.run(["$templateCache",function(e){e.put("location/location.html","")}])}(),function(e){try{e=angular.module("simplicity")}catch(t){e=angular.module("simplicity",[])}e.run(["$templateCache",function(e){e.put("main/main.html",'<div class="col-md-6 col-md-offset-3"><br><div class="col-xs-12"><div class="col-xs-12 hidden-xs"><div class="pull-left" ng-click="goHome();" ;="" style="cursor : pointer"><h1 style="color : #073F97">SimpliCity</h1><h4>city data simplified</h4></div><img class="pull-right" style="margin-top: 5px; height : 100px" src="http://123graffitifree.com/images/citylogo-flatblue.png"></div><div class="col-xs-12 visible-xs"><div class="pull-left" ng-click="goHome();" ;="" style="cursor : pointer"><h4 style="color : #073F97">SimpliCity</h4><h5>city data simplified</h5></div><img class="pull-right " style="margin-top: 5px; height : 50px" src="http://123graffitifree.com/images/citylogo-flatblue.png"></div><div class="col-xs-12"><br></div><div class="row"><input tabindex="1" type="text" autocomplete="on" class="form-control" placeholder="Enter a location" style="z-index: 0" ng-model="typedLocation" ng-keypress="getAddressCandidates(typedLocation, $event)"><div class="row col-xs-12"><p ng-show="errorMessage.show" class="text-danger">{{errorMessage.message}}</p><p ng-show="helperMessage.show" class="text-warning">{{helperMessage.message}}</p><div class="list-group" style="width : 100%; position : absolute; z-index : 1000; max-height : 230px; overflow-y: scroll"><a tabindex="{{$index+1}}" ng-click="getLocationProperties(candidate, $event)" ng-keypress="getLocationProperties(candidate, $event)" ng-repeat="candidate in addresses.candidates" class="list-group-item"><p class="text-info">{{candidate.attributes.House}} {{candidate.attributes.preType}} {{candidate.attributes.StreetName}} {{candidate.attributes.SufType}} {{candidate.attributes.SufDir}} <span ng-if="candidate.attributes.User_fld !== \'\'">UNIT: {{candidate.attributes.User_fld}}</span>, {{candidate.attributes.ZIP}}</p></a></div><p ng-show="errorMessage.show" class="text-danger">{{errorMessage.message}}</p></div></div><div class="col-xs-12"><br></div></div><div class="col-xs-12 content" style="height : 400px"><div ui-view="" class="slide"></div></div><div class="modal fade" id="modal" style="z-index : 3000"><div class="modal-dialog modal-sm"><div class="modal-content"><div class="modal-header" ng-if="modal.category === \'crime\'"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">{{modal.offense}}</h4></div><div class="modal-header" ng-if="modal.category === \'development\'"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">{{modal.record_type}}</h4></div><div class="modal-body"><div class="col-xs-12" ng-if="modal.category === \'development\'"><h5 class="text-center">{{modal.address}}</h5><div class="col-xs-12"><p class="text-muted"><strong>Opened:</strong> {{modal.date_opened|date}}</p><p class="text-muted"><strong>Updated:</strong> {{modal.date_statused|date}}</p><p class="text-muted"><strong>Status:</strong> {{modal.record_status}}</p><p class="text-muted"><strong>Business Name:</strong> {{modal.business_name}}</p><p class="text-muted"><strong>Description:</strong> {{modal.description}}</p></div></div><div class="col-xs-12 list-item-panel" ng-if="modal.category === \'crime\'"><div class="col-xs-12"><h5 class="lead">{{modal.address}}</h5><h5 class="text-muted"><strong>{{modal.thedate|date}}</strong></h5><p class="text-muted"><strong>Case #</strong>: {{modal.casenumber}}</p><p class="text-muted"><strong>Law Beat</strong>: {{modal.law_beat}}</p><p class="text-muted"><strong>Severity</strong>: {{modal.severity}}</p></div><a ng-click="showMore = !showMore"><p class="text-center" ng-if="showMore">Show More</p><p class="text-center" ng-if="showMore">Show Less</p></a></div></div></div></div></div></div>')}])}(),function(e){try{e=angular.module("simplicity")}catch(t){e=angular.module("simplicity",[])}e.run(["$templateCache",function(e){e.put("questions/questions.html",'<div class="col-xs-12"><div class="list-group"><a class="col-xs-12 list-group-item list-item-panel hidden-xs"><div class="col-xs-12 col-sm-4"><address class="pull-left"><strong>{{locationProperties.address.attributes.House}} {{locationProperties.address.attributes.preType}} {{locationProperties.address.attributes.StreetName}} {{locationProperties.address.attributes.SufType}} {{locationProperties.address.attributes.SufDir}} <span ng-if="locationProperties.address.attributes.User_fld !== \'\'">UNIT: {{locationProperties.address.attributes.User_fld}}</span></strong><br><span ng-if="locationProperties.inTheCity">Asheville, NC</span> {{locationProperties.address.attributes.ZIP}}</address></div><div class="col-xs-12 col-sm-8"><div ng-if="locationProperties.inTheCity" class="pull-right"><i class="fa fa-check-circle fa-2x text-success pull-left" style="margin-top : 10px"></i><h3 class="pull-left" style="margin-top : 7px">It\'s in the city!</h3></div><div ng-if="!locationProperties.inTheCity" class="pull-right"><i class="fa fa-times-circle fa-2x text-danger pull-left" style="margin-top : 10px"></i><h3 class="pull-left" style="margin-top : 7px">It\'s not in the city!</h3></div></div></a> <a class="col-xs-12 list-group-item list-item-panel visible-xs"><div class="col-xs-12 col-md-4"><address><strong>{{locationProperties.address.attributes.House}} {{locationProperties.address.attributes.preType}} {{locationProperties.address.attributes.StreetName}} {{locationProperties.address.attributes.SufType}} {{locationProperties.address.attributes.SufDir}} <span ng-if="locationProperties.address.attributes.User_fld !== \'\'">UNIT: {{locationProperties.address.attributes.User_fld}}</span></strong><br><span ng-if="locationProperties.inTheCity">Asheville, NC</span> {{locationProperties.address.attributes.ZIP}}</address></div></a> <a ng-if="locationProperties.inTheCity" class="col-xs-12 list-group-item list-item-panel visible-xs"><i class="fa fa-check-circle fa-2x text-success pull-left" style=""></i><h5 class="pull-left" style="margin-top : 7px">It\'s in the city!</h5></a> <a ng-if="!locationProperties.inTheCity" class="col-xs-12 list-group-item list-item-panel visible-xs"><i class="fa fa-times-circle fa-2x text-danger pull-left" style="margin-top : 10px"></i><h5 class="pull-left" style="margin-top : 7px">It\'s not in the city!</h5></a> <a class="col-xs-12 list-group-item list-item-panel" ng-click="getAnswer(question)" ng-repeat="question in questions" tabindex="{{$index + 11}}"><h4>{{question.question}}<i class="fa fa-chevron-right pull-right text-primary" style="margin-top: 4px"></i></h4></a> <a class="col-xs-12 list-group-item list-item-panel" ng-show="more.show" ng-click="more.get()" tabindex="{{questions.length + 12}}"><h3 class="text-primary" style="text-align : center">More</h3></a></div></div>')}])}(),function(e){try{e=angular.module("simplicity")}catch(t){e=angular.module("simplicity",[])}e.run(["$templateCache",function(e){e.put("time/time.html",'<div><div class="form-group col-xs-12" ng-show="show"><select class="form-control" id="time" ng-init="timeValue = timeOptions[defaultOption]" ng-model="timeValue" ng-options="item.label for item in timeOptions" ng-change="onChangeTimeValue()" style="width : 100%"></select></div><div ui-view=""></div></div>')}])}(),function(e){try{e=angular.module("simplicity")}catch(t){e=angular.module("simplicity",[])}e.run(["$templateCache",function(e){e.put("details/cards/card.directive.html","<div></div>")}])}(),function(e){try{e=angular.module("simplicity")}catch(t){e=angular.module("simplicity",[])}e.run(["$templateCache",function(e){e.put("details/cards/crime.card.html",'<div><div class="col-xs-12"><div class="col-xs-12 col-sm-6"><h5 class="pull-left">{{card.attributes.address}}</h5></div><div class="col-xs-12 col-sm-6"><h5 class="pull-right">{{card.attributes.thedate|date}}</h5></div></div><div class="col-xs-12"><div class="col-xs-12 col-sm-4"><p class="text-center"><strong>Case Number</strong></p><p class="text-center">{{card.attributes.casenumber}}</p></div><div class="col-xs-12 col-sm-4"><p class="text-center"><strong>Law Beat</strong></p><p class="text-center">{{card.attributes.law_beat}}</p></div><div class="col-xs-12 col-sm-4"><p class="text-center"><strong>Severity</strong></p><p class="text-center">{{card.attributes.severity}}</p></div></div><a ng-click="showMore = !showMore"><p class="text-center" ng-if="showMore">Show More</p><p class="text-center" ng-if="showMore">Show Less</p></a></div>')}])}(),function(e){try{e=angular.module("simplicity")}catch(t){e=angular.module("simplicity",[])}e.run(["$templateCache",function(e){e.put("details/cards/development.card.html",'<div><h5 class="text-center">{{card.attributes.address}}</h5><div class="col-xs-12"><div class="col-xs-12 col-sm-4"><strong>Opened</strong><p>{{card.attributes.date_opened|date}}</p></div><div class="col-xs-12 col-sm-4"><strong>Updated</strong><p>{{card.attributes.date_statused|date}}</p></div><div class="col-xs-12 col-sm-4"><strong>Status</strong><p>{{card.attributes.record_status}}</p></div></div><div class="col-xs-12"><p><strong>Description:</strong>{{card.attributes.description}}</p></div><div ng-init="showMore = false" ng-show="showMore"><div class="col-xs-12"><div class="pull-left"><strong>Record Id</strong><p>{{card.attributes.record_id}}</p></div><div class="pull-right"><strong>License Number</strong><p>{{card.attributes.license_number}}</p></div></div><div class="col-xs-12"><div class="pull-left"><strong>Record Name</strong><p>{{card.attributes.record_name}}</p></div><div class="pull-right"><strong>Business Name</strong><p>{{card.attributes.business_name}}</p></div></div><div ng-init="showComments = false" ng-show="showComments"><strong>Comments</strong><ul class="list-group"><li class="list-group-card list-card-panel" ng-repeat="comment in card.attributes.commentsArray">{{comment}}</li></ul></div><a ng-click="showComments = !showComments"><p class="text-center" ng-if="!showComments">Show Comments</p><p class="text-center" ng-if="showComments">Hide Comments</p></a></div><a ng-click="showMore = !showMore"><p class="text-center" ng-if="!showMore">Show More</p><p class="text-center" ng-if="showMore">Show Less</p></a></div>')
}])}(),function(e){try{e=angular.module("simplicity")}catch(t){e=angular.module("simplicity",[])}e.run(["$templateCache",function(e){e.put("details/cards/property.card.html",'<div class="col-xs-12"><div class="col-xs-12" style="padding : 10px"><div class="col-xs-12 list-item-panel"><div class="col-xs-12 col-sm-6"><h5><strong>Civic Address Id</strong> : <span>{{card.attributes.civicAddressId}}</span></h5><h5><strong>PIN</strong> : <span>{{card.attributes.pinnum}}</span></h5></div><div class="col-xs-12 col-sm-6"><h5 ng-if="card.attributes.isincity === \'Yes\'"><i class="fa fa-check-circle text-success pull-left"></i> It\'s in the city!</h5><h5 ng-if="card.attributes.isincity === \'No\'"><i class="fa fa-times-circle text-danger pull-left"></i> It\'s not in the city!</h5><h5 ng-if="card.attributes.iscityowned === \'Yes\'"><i class="fa fa-check-circle text-success pull-left"></i> It\'s city owned!</h5><h5 ng-if="card.attributes.iscityowned === \'No\'"><i class="fa fa-times-circle text-danger pull-left"></i> It\'s not city owned!</h5></div></div><div class="col-xs-12 list-item-panel" ng-cloak=""><div ng-if="card.ownerCard" card="card.ownerCard"></div></div><div class="col-xs-12 list-item-panel" ng-cloak=""><div ng-if="card.zoningCard" card="card.zoningCard"></div></div><div class="col-xs-12 list-item-panel"><h4>Tax Details</h4><p ng-if="card.attributes.exempt === null">Tax exempt : <span class="text-danger">NO</span></p><p ng-if="card.attributes.exempt !== null">Tax exempt : <span class="text-success">YES</span></p><p ng-if="card.attributes.improved === \'Y\'">Improved : <span class="text-success">YES (${{card.attributes.improvementvalue|number}})</span></p><p>Appraisal Area : {{card.attributes.appraisalarea}}</p></div><div class="col-xs-12 list-item-panel"><h4>Property and Tax Value</h4><table class="table "><thead><tr><th>Value Type</th><th>Amount</th></tr></thead><tbody><tr><td>Building Value</td><td>${{card.attributes.buildingvalue|number}}</td></tr><tr><td>Land Value</td><td>${{card.attributes.landvalue|number}}</td></tr><tr><td>Appraised Value</td><td>${{card.attributes.appraisedvalue|number}}</td></tr><tr><td>Tax Value</td><td>${{card.attributes.taxvalue|number}}</td></tr><tr><td>Total Market Value</td><td>${{card.attributes.totalmarketvalue|number}}</td></tr></tbody></table></div><div class="col-xs-12 list-item-panel"><br><a class="col-xs-12 col-sm-4 text-center" style="margin-bottom : 10px" target="_blank" href="{{card.attributes.deed_url}}">Deed</a> <a class="col-xs-12 col-sm-4 text-center" style="margin-bottom : 10px" target="_blank" href="{{card.attributes.plat_url}}">Plat</a> <a class="col-xs-12 col-sm-4 text-center" style="margin-bottom : 10px" target="_blank" href="{{card.attributes.propcard_url}}">Property Card</a><br></div></div></div>')}])}(),function(e){try{e=angular.module("simplicity")}catch(t){e=angular.module("simplicity",[])}e.run(["$templateCache",function(e){e.put("details/cards/property.owner.card.html","<div><h4>Owner</h4><strong>{{card.owner}}</strong><address>{{card.owner_address}}<br>{{card.owner_citystatezip}}</address></div>")}])}(),function(e){try{e=angular.module("simplicity")}catch(t){e=angular.module("simplicity",[])}e.run(["$templateCache",function(e){e.put("details/cards/property.zoning.card.html",'<div><h4>Zoning</h4><h5 ng-if="card.codelinks === \'disable\'"><strong>Zoning District</strong> : <span>{{card.zoning}}</span></h5><h5 ng-if="card.codelinks !== \'disable\'"><strong>Zoning District</strong> : <a target="_blank" href="{{card.codelinks[card.zoning]}}">{{card.zoning}}</a></h5><h5><strong>Zoning Overlay</strong> : <span>{{card.zoningOverlays}}</span></h5></div>')}])}(),function(e){try{e=angular.module("simplicity")}catch(t){e=angular.module("simplicity",[])}e.run(["$templateCache",function(e){e.put("details/cards/sanitation.card.html",'<div class="col-xs-12 list-item-panel"><div class="col-xs-12" style="padding : 10px"><h4>Trash</h4><p>Your trash is collected every <strong>{{card.trash}}</strong>.</p><br><h4>Recycling</h4><p class="text-muted">Recycling is collected every other week.</p><p>Your recycling will be collected <strong>{{card.recyclingSchedule.when}} on {{card.recycling}}</strong>.</p><br><h4>Brush and Leaf Collection</h4><p class="text-muted">Brush and leaves are collected every other week, and should be placed at the curb by 7 a.m. on Monday of your pickup week.</p><p>Your brush will be collected <strong>{{card.brushSchedule.when}}</strong>.</p><br><h4>Bulky Item Collection</h4><p>Call to schedule pickup <a href="tel:8282511122" target="_blank">(828) 251-1122</a>. <a href="http://www.ashevillenc.gov/Departments/Sanitation/BulkyItemCollection.aspx" target="_blank">More Info.</a></p></div></div>')}])}(),function(e){try{e=angular.module("simplicity")}catch(t){e=angular.module("simplicity",[])}e.run(["$templateCache",function(e){e.put("details/cards/summary.table.card.html",'<div class="col-xs-12"><div class="col-xs-12 list-item-panel"><table class="table"><thead><tr><th>Type</th><th class="text-center">Count</th></tr></thead><tbody><tr ng-repeat="(key, value) in card.table"><td><i class="fa fa-circle" style="color: #{{value.color}}"></i> {{key}}<br><p class="text-muted">{{developmentExplanations[key]}}</p></td><td class="text-center">{{value.count}}</td></tr></tbody></table></div></div>')}])}(),function(e){try{e=angular.module("simplicity")}catch(t){e=angular.module("simplicity",[])}e.run(["$templateCache",function(e){e.put("details/map/map.directive.html",'<div class="col-xs-12"><div id="map" style="width : 100%; height : 400px"><div class="modal fade" id="pointDetailsModal" style="z-index : 3000"><div class="modal-dialog modal-sm" style="width: 90%;max-width: 500px;"><div class="modal-content"><div class="modal-header" ng-if="category === \'crime\'"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">{{modalData.offense}}</h4></div><div class="modal-header" ng-if="category === \'development\'"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">{{modalData.record_type}}</h4></div><div class="modal-body"><div class="col-xs-12" ng-if="category === \'development\'"><h5 class="text-center">{{modalData.address}}</h5><div class="col-xs-12"><p class="text-muted"><strong>Opened:</strong> {{modalData.date_opened|date}}</p><p class="text-muted"><strong>Updated:</strong> {{modalData.date_statused|date}}</p><p class="text-muted"><strong>Status:</strong> {{modalData.record_status}}</p><p class="text-muted"><strong>Business Name:</strong> {{modalData.business_name}}</p><p class="text-muted"><strong>Description:</strong> {{modalData.description}}</p></div></div><div class="col-xs-12 list-item-panel" ng-if="category === \'crime\'"><div class="col-xs-12"><h5 class="lead">{{modalData.address}}</h5><h5 class="text-muted"><strong>{{modalData.thedate|date}}</strong></h5><p class="text-muted"><strong>Case #</strong>: {{modalData.casenumber}}</p><p class="text-muted"><strong>Law Beat</strong>: {{modalData.law_beat}}</p><p class="text-muted"><strong>Severity</strong>: {{modalData.severity}}</p></div><a ng-click="showMore = !showMore"><p class="text-center" ng-if="showMore">Show More</p><p class="text-center" ng-if="showMore">Show Less</p></a></div></div></div></div></div></div><div class="col-xs-12"><a ng-click="goTo(report);"><p class="text-center">View Report</p></a></div></div>')}])}(),function(e){try{e=angular.module("simplicity")}catch(t){e=angular.module("simplicity",[])}e.run(["$templateCache",function(e){e.put("details/report/report.directive.html",'<div class="col-xs-12"><div class="col-xs-12" style="height : 100px; text-align : center" ng-show="loading"><i class="fa fa-5x fa-spinner fa-spin"></i></div><div ng-if="report.category === \'property\'"><div ng-if="propertyDetails" card="propertyDetails"></div></div><div ng-if="report.category === \'sanitation\'"><div ng-if="sanitation" card="sanitation"></div></div><div ng-if="report.category === \'crime\' || report.category === \'development\'"><div class="col-xs-12" ng-if="isEmpty">No results were found based on your search criteria.</div><div ng-if="!isEmpty" ng-show="showSummary"><div ng-if="filteredDetails.summary" card="filteredDetails.summary"></div></div><div class="col-xs-12 list-item-panel" ng-repeat="feature in filteredDetails.features" ng-show="!showSummary" ng-cloak=""><div card="feature"></div></div></div><div class="col-xs-12 btn-group btn-group-justified" role="group" ng-if="showFooter"><a class="col-xs-12 col-sm-4 text-center" ng-click="goTo(map);">View on Map</a> <a class="col-xs-12 col-sm-4 text-center" ng-click="openShareModal();">Share</a> <a class="col-xs-12 col-sm-4 text-center" ng-click="openDownloadModal(filteredDetails);">Download</a></div><div id="downloadModal" class="modal fade" style="z-index : 3000"><div class="modal-dialog modal-sm"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">Download</h4></div><div class="modal-body"><div ng-if="report.category === \'property\'"><button class="btn btn-primary col-xs-12" ng-click="download(\'property\', propertyDetails)">Property Details <i class="fa fa-cloud-download"></i></button></div><div ng-if="report.category === \'crime\' || report.category === \'development\'"><button class="btn btn-primary col-xs-12" ng-click="download(\'summary\', filteredDetails)">Summary Table <i class="fa fa-cloud-download"></i></button> <button class="btn btn-primary col-xs-12" style="margin-top : 3px" ng-click="download(\'complete\', filteredDetails)">Complete records <i class="fa fa-cloud-download"></i></button><p class="text-muted text-center">based on selected filters</p></div></div></div></div></div><div id="shareModal" class="modal fade" style="z-index : 3000"><div class="modal-dialog modal-sm"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">Share</h4></div><div class="modal-body"><h5 class="text-primary">Link <i class="fa fa-link"></i></h5><pre>{{currentUrl}}</pre><h5 class="text-primary">Embed <i class="fa fa-share-alt"></i></h5><pre>{{iframeText}}</pre></div></div></div></div></div>')}])}(),app.directive("card",["$compile","$templateCache","$filter","$state","$stateParams","$q","$timeout","Details","LocationProperties","Filter",function(e,t){return{restrict:"A",scope:{card:"= card"},replace:!0,templateUrl:"details/cards/card.directive.html",link:function(a,i){console.log(a.card),console.log("$scope.card");var s={crime:"details/cards/crime.card.html",development:"details/cards/development.card.html",zoning:"details/cards/property.zoning.card.html",owner:"details/cards/property.owner.card.html",summary:"details/cards/summary.table.card.html",property:"details/cards/property.card.html",sanitation:"details/cards/sanitation.card.html"};a.developmentExplanations={"Planning Level I":"Commercial construction less than 35,000 square feet or less than 20 multi-family units","Planning Level II":"Commercial construction 35,000-100,000 square feet or 20-50 multi-family units","Planning Level III":"Commercial construction larger than 100,000 square feet or more than 50 multi-family units"};var r=t.get(s[a.card.template]);i.replaceWith(i.html(r)),e(i.contents())(a)}}}]),app.directive("map",["$compile","$filter","$state","$stateParams","$q","$timeout","Details","Extent","LocationProperties",function(e,t,a,i,s,r,o,n,l){return{restrict:"A",scope:{map:"= map"},replace:!0,templateUrl:"details/map/map.directive.html",controller:["$scope",function(e){var t=function(e){for(var t={type:"FeatureCollection",features:[]},a=0;a<e.features.length;a++){var i={type:"Feature",geometry:{type:"Point",coordinates:[e.features[a].geometry.x,e.features[a].geometry.y]},properties:e.features[a].attributes};t.features.push(i)}return t},s=function(t){return L.geoJson(t,{pointToLayer:function(e,t){return L.circleMarker(t,{radius:6,fillColor:"#"+e.properties.color,color:"#"+e.properties.color,weight:1,opacity:1,fillOpacity:.8})},onEachFeature:function(t,a){a.on("click",function(){e.getPointDetails(t.properties),e.pointDetails=t.properties,e.$apply()})}})},r=function(e){var t={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[e.geometry.rings[0]]},properties:e.attributes}]};return t},c=function(e,t){return L.geoJson(e,{style:function(){return t?t:void 0},onEachFeature:function(e,t){t.on("click",function(){})}})},d=L.tileLayer("http://a.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright" title="OpenStreetMap" target="_blank">OpenStreetMap</a> contributors',maxZoom:22}),u=L.esri.basemapLayer("Imagery"),p={"Open Street Map":d,"ESRI Imagery":u},m=L.map("map",{center:[35.5951125,-82.5511088],zoom:13,maxZoom:22,fullscreenControl:!0,layers:[d]}),g=L.control.layers(p).addTo(m);$(".leaflet-control-attribution").css("maxWidth","90%"),l.properties().then(function(a){e.locationProperties=a,"property"===e.map.category?o.getPropertyDetails(e.map.location).then(function(t){a.zoningOverlays&&o.getZoningOverlays(a.zoningOverlays).then(function(e){var t=r(e),a=c(t,{color:"red"});g.addOverlay(a,"Zoning Overlays")}),e.propertyDetails=t;var i=r(t),s=c(i);s.addTo(m),m.fitBounds(s),m.setZoom(18)}):o.getFilteredDetails().then(function(e){var i=n.filterValue(),r=.3048*i;L.marker([a.address.location.y,a.address.location.x]).addTo(m);var o=L.circle([a.address.location.y,a.address.location.x],r,{fillOpacity:0});o.addTo(m);var l=o.getBounds();m.fitBounds(l);var c=t(e),d=s(c);d.addTo(m)})}),e.crime=!0,"crime"!==i.category&&(e.crime=!1),e.showMarkerDetails=!1,e.getPointDetails=function(t){e.modalData=t,e.category=i.category,$("#pointDetailsModal").modal({backdrop:!1})},e.goTo=function(){a.go("main.location.category.time.extent.filter.details",{details:"report"})}}]}}]),app.directive("report",["$compile","$filter","$state","$stateParams","$q","$timeout","Details","LocationProperties","Filter",function(e,t,a,i,s,r,o,n){return{restrict:"A",scope:{report:"= report"},replace:!0,templateUrl:"details/report/report.directive.html",controller:["$scope",function(e){e.loading=!1,e.showSummary=!0,e.showFooter=!0;var t=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},s=function(e,t){var a={};return a.template="zoning",a.zoning=e.zoning[0],a.codelinks=t,a.zoningOverlays=e.zoningOverlays?e.zoningOverlays:"No Zoning Overlays",a},r=function(e){var t={};return t.template="owner",t.owner=e.owner,t.owner_address=e.owner_address,t.owner_citystatezip=e.owner_citystatezip,t};n.properties().then(function(a){e.locationProperties=a,"property"===e.report.category?o.getPropertyDetails(e.report.location).then(function(t){console.log(t),t.attributes.civicAddressId=i.location,t.zoningCard=s(a,t.attributes.codelinks),t.ownerCard=r(t.attributes),t.template="property",e.propertyDetails=t}):"sanitation"===e.report.category?(console.log(a.sanitation),e.showFooter=!1,e.sanitation=a.sanitation,e.sanitation.template="sanitation",e.sanitation.recyclingSchedule=o.getRecyclingSchedule(a.sanitation.recycling),e.sanitation.brushSchedule=o.getBrushSchedule(e.sanitation.recyclingSchedule,a.sanitation.trash)):(e.loading=!0,o.getFilteredDetails().then(function(a){e.filteredDetails=a,console.log("$scope.filteredDetails"),console.log(e.filteredDetails),e.isEmpty=t(a.summary),e.showSummary="summary"===i.filter?!0:!1,e.loading=!1}))}),e.getTemplate=function(){return templates[e.report.category]},e.goTo=function(){a.go("main.location.category.time.extent.filter.details",{details:"map"})},e.openDownloadModal=function(){$("#downloadModal").modal({backdrop:!1})},e.openShareModal=function(){$("#shareModal").modal({backdrop:!1})},e.download=function(e,t){console.log(t);var a="data:text/csv;charset=utf-8,";if("summary"===e){a+="Type, Count\n";for(var i in t.summary){var s=i+","+t.summary[i].count;a+=s+"\n"}console.log(a)}else{var r=[];for(var i in t.features[0].attributes)r.push(i);for(var i in t.features[0].geometry)r.push(i);a+=r.join(",")+"\n";for(var o=0;o<t.features.length;o++){for(var n=[],l=0;l<r.length;l++)n.push(t.features[o].attributes[r[l]]?t.features[o].attributes[r[l]]:t.features[o].geometry[r[l]]?t.features[o].geometry[r[l]]:"NULL");console.log(n),a+=n.join(",")+"\n"}}var c=encodeURI(a);window.open(c)},e.currentUrl=window.location.href,e.iframeText='<iframe width="100%" height="100%" style = "overflow-y" src="'+window.location.href+'" frameborder="0" ></iframe>'}]}}]);