"use strict";var app=angular.module("simplicity",["ui.router","ngAnimate"]);app.config(["$stateProvider","$urlRouterProvider","$httpProvider",function(t,e){t.state("main",{url:"",templateUrl:"main/main.html",controller:"MainCtrl"}).state("main.location",{url:"/:location",template:'<div ui-view style = "z-index : 100" class = "slide"></div>',controller:"LocationCtrl",resolve:{location:["$stateParams","AppFact",function(t,e){e.locationProperties(t.location).then(function(){return t.location})}]}}).state("main.location.list",{url:"/list",templateUrl:"list/list.html",controller:"ListCtrl"}).state("main.location.category",{url:"/:category",templateUrl:"category/category.html",controller:"CategoryCtrl",resolve:{category:["$stateParams",function(t){return t.category}]}}).state("main.location.category.time",{url:"/:time",templateUrl:"time/time.html",controller:"TimeCtrl",resolve:{time:["$stateParams",function(t){return t.time}]}}).state("main.location.category.time.extent",{url:"/:extent",templateUrl:"extent/extent.html",controller:"ExtentCtrl",resolve:{extent:["$stateParams",function(t){return t.extent}]}}).state("main.location.category.time.extent.filter",{url:"/:filter",templateUrl:"filter/filter.html",controller:"FilterCtrl",resolve:{filter:["$stateParams",function(t){return t.filter}]}}).state("main.location.category.time.extent.filter.details",{url:"/:details",templateUrl:"details/details.html",controller:"DetailsCtrl",resolve:{details:["$stateParams",function(t){return t.details}]}}),e.when("/a-zA-Z0-9/",""),e.otherwise("")}]),app.factory("AppFact",["$http","$location","$q","$filter",function(t,e,i){var l={},o="fresh",a=function(){var t=i.defer(),e={locationName:"123456",locationType:"cai",inTheCity:!0,address:"25 Howland Rd",city:"Asheville",state:"NC",zip:28804};return o=e,t.resolve(e),t.promise},n=[{question:"Do you want to know about crime?",category:"crime",detail:"within-quarter-mile"},{question:"Do you want to know about this property?",category:"property",detail:"summary"},{question:"Do you want to know about development?",category:"development",detail:"summary"},{question:"Do you want to know about the owner?",category:"property",detail:"owner"},{question:"Do you want to know about the zoning?",category:"property",detail:"zoning"},{question:"Do you want to know about the trash collection?",category:"property",detail:"trash"}],r=[{question:"Do you want to know about crime?",category:"crime",detail:"quarter-mile"},{question:"Do you want to know about development?",category:"development",detail:"summary"}],s={title:"Crime",category:"crime",time:"2014",extent:"within-a-quarter-mile",filter:"summary",details:"report"},c={showTimeOptions:!0,defaultTimeOption:2,showExtentOptions:!1,defaultExtentOption:"neighborhood",showFilterOptions:!1,defaultFilterOption:"summary"},m={showTimeOptions:!1,defaultTimeOption:"current",showExtentOptions:!1,defaultExtentOption:"location",showFilterOptions:!1,defaultFilterOption:"summary"},u={cai:{crime:s,property:m},neighborhood:{crime:c}},p=[{value:"last-6-months",label:"During the last 6 months"},{value:"last-year",label:"During the last year"},{value:"2014",label:"During the year 2014"},{value:"2013",label:"During the year 2013"},{value:"2012",label:"During the year 2012"}],d=[{value:"within-a-quarter-mile",label:"Within a quarter mile"},{value:"within-a-half-mile",label:"Within a half mile"},{value:"within-a-mile",label:"Within a mile"},{value:"within-5-miles",label:"Within 5 miles"}],g=[{value:"summary",label:"Property Summary"},{value:"zoning",label:"Zoning"},{value:"owner",label:"Owner"},{value:"deed",label:"Deed"},{value:"garbage",label:"Garbage Collection"},{value:"recycling",label:"Recycling"},{value:"leaf",label:"Leaf & Brush Collection"}],h=[{value:"summary",label:"Crime Summary"},{value:"aggravated-assault",label:"Aggravated Assaults"},{value:"rape",label:"Rapes"},{value:"vandalism",label:"Vandalism"},{value:"larceny",label:"Larcenies"},{value:"larceny-auto",label:"Larcenies (Auto)"}];return l.locationProperties=function(t){var e=i.defer();return"fresh"===o||o.locationName!==t?a(t).then(function(t){e.resolve(t)}):e.resolve(o),e.promise},l.questions=function(){return console.log("questions"),console.log(o),"cai"===o.locationType?n:r},l.categoryDefinition=function(t){return"cai"===o.locationType?u.cai[t]:u.neighborhood[t]},l.timeOptions=function(t){return void 0===t?p:void(p=t)},l.extentOptions=function(t){return void 0===t?d:void(d=t)},l.propertyFilterOptions=function(t){return void 0===t?g:void(g=t)},l.filterOptions=function(t){return void 0===t?h:void(h=t)},l}]),app.controller("CategoryCtrl",["$scope","$stateParams","$state","AppFact",function(t,e,i,l){var o=l.categoryDefinition(e.category);t.category=o}]),app.controller("DetailsCtrl",["$scope","$stateParams","$state",function(){}]),app.controller("ExtentCtrl",["$scope","$stateParams","$state","AppFact",function(t,e,i,l){if("location"===e.extent||"neightborhood"===e.extent)t.show=!1;else{t.show=!0,t.extentOptions=l.extentOptions(),console.log(t.extentOptions);for(var o=0;o<t.extentOptions.length;o++)t.extentOptions[o].value===e.extent&&(console.log(o),t.defaultOption=2)}t.onChangeExtentValue=function(){i.go("main.location.category.time.extent.filter.details",{extent:t.extentValue.value})}}]),app.controller("FilterCtrl",["$scope","$stateParams","$state","AppFact",function(t,e,i,l){t.filterOptions=l.filterOptions(),console.log(t.filterOptions);for(var o=0;o<t.filterOptions.length;o++)t.filterOptions[o].value===e.filter&&(console.log(o),t.defaultOption=o);t.show="summary"===e.filter?!1:!0,t.onChangeFilterValue=function(){i.go("main.location.category.time.extent.filter.details",{filter:t.filterValue.value})}}]),app.directive("coaForm",["$compile","$filter","$state","$stateParams","$q",function(t,e,i){return{restrict:"A",scope:{coaForm:"= coaForm"},replace:!0,templateUrl:"form/form.html",controller:["$scope",function(t){"onChange"===t.coaForm.submit&&t.$watch("coaForm.elements",function(){for(var e=[],l=0;l<t.coaForm.elements.length;l++)e.push(t.coaForm.elements[l].returnValue.value);e.join("-");i.go("main.location.category.time.detail.summary",{time:e[0],detail:e[1]})},!0)}]}}]),app.directive("coaFormElement",["$compile","$filter","$state","$q",function(){return{restrict:"A",scope:{coaFormElement:"= coaFormElement"},replace:!0,templateUrl:"form-element/form-element.html",controller:["$scope",function(t){console.log(t.coaFormElement);var e={select:"form-element/select.html"};t.getTemplate=function(){return e[t.coaFormElement.type]},"Select"===t.coaFormElement.type&&(t.doOnChange=function(){})}]}}]),app.controller("ListCtrl",["$scope","$state","AppFact","location",function(t,e,i,l){i.locationProperties(l).then(function(e){t.locationProperties=e});var o=i.questions();t.questions=o.slice(0,2),t.more={show:!0,get:function(){var e=t.questions.length,i=3;o.length-e<3&&(i=o.length-e);var l=e+i;t.questions=o.slice(0,l),l===o.length&&(this.show=!1)}},t.questions===o.length&&(t.more.show=!1),t.getAnswer=function(){var l=i.categoryDefinition("crime");t.category=l,e.go("main.location.category.time.extent.filter.details",l)}}]),app.controller("LocationCtrl",[function(){}]),app.controller("MainCtrl",["$scope","$state","$location","$http","$timeout","AppFact",function(t,e,i,l){t.typedLocation="",t.addresses=[],t.errorMessage={show:!1,message:"We had trouble locating that location. Please try to enter a location again."},t.getAddressCandidates=function(e){var i="http://arcgis-arcgisserver1-1222684815.us-east-1.elb.amazonaws.com/arcgis/rest/services/test_open/MapServer/0/query",o="address like '%"+e.toUpperCase()+"%'",a={where:o,outFields:"*",f:"json"};l({method:"GET",url:i,params:a,cache:!0}).success(function(e){t.addresses=e.features.splice(0,10),console.log(t.addresses)}).error(function(t){console.log(t)})},t.getThisLocation=function(i){console.log(JSON.stringify(i)),e.go("main.location.list",{location:i.attributes.civicaddress_id}),t.addresses=[],t.typedLocation=i.attributes.address},t.getLocation=function(){},t.goHome=function(){i.path("")}}]),function(t){try{t=angular.module("simplicity")}catch(e){t=angular.module("simplicity",[])}t.run(["$templateCache",function(t){t.put("category/category.html",'<div><div class="panel panel-default"><div class="panel-body"><h3>{{category.title}}</h3><div ng-if="category.hasForm" coa-form="category.form"></div><div ui-view=""></div></div></div></div>')}])}(),function(t){try{t=angular.module("simplicity")}catch(e){t=angular.module("simplicity",[])}t.run(["$templateCache",function(t){t.put("details/details.html",'<div><table class="table table-condensed table-striped"><thead><tr><th>Type</th><th style="text-align : center">Number</th></tr></thead><tbody><tr><td>Aggravated Assault</td><td style="text-align : center">2</td></tr><tr><td>Burglary</td><td style="text-align : center">12</td></tr><tr><td>Drug Arrest</td><td style="text-align : center">2</td></tr><tr><td>Larceny</td><td style="text-align : center">28</td></tr><tr><td>Larceny of Motor Vehicles</td><td style="text-align : center">2</td></tr><tr><td>Rape</td><td style="text-align : center">1</td></tr><tr><td>Robbery</td><td style="text-align : center">0</td></tr><tr><td>Vandalism</td><td style="text-align : center">8</td></tr></tbody></table><a ui-sref="main.location.category.time.detail.map">Map</a></div>')}])}(),function(t){try{t=angular.module("simplicity")}catch(e){t=angular.module("simplicity",[])}t.run(["$templateCache",function(t){t.put("extent/extent.html",'<div><div class="form-group" ng-show="show"><select class="form-control" id="extent" ng-init="extentValue = extentOptions[defaultOption]" ng-model="extentValue" ng-options="item.label for item in extentOptions" ng-change="onChangeExtentValue()" style="width : 100%"></select></div><div ui-view=""></div></div>')}])}(),function(t){try{t=angular.module("simplicity")}catch(e){t=angular.module("simplicity",[])}t.run(["$templateCache",function(t){t.put("filter/filter.html",'<div><a ng-click="show = !show" ng-show="!show">Filter Results</a> <a ng-click="show = !show" ng-show="show">Remove Filter</a><div class="form-group" ng-show="show"><select class="form-control" id="filter" ng-init="filterValue = filterOptions[defaultOption]" ng-model="filterValue" ng-options="item.label for item in filterOptions" ng-change="onChangeFilterValue()" style="width : 100%"></select></div><hr><div ui-view=""></div></div>')}])}(),function(t){try{t=angular.module("simplicity")}catch(e){t=angular.module("simplicity",[])}t.run(["$templateCache",function(t){t.put("form/form.html",'<form><div ng-repeat="formElement in coaForm.elements"><div coa-form-element="formElement"></div></div></form>')}])}(),function(t){try{t=angular.module("simplicity")}catch(e){t=angular.module("simplicity",[])}t.run(["$templateCache",function(t){t.put("form-element/form-element.html",'<div ng-include="getTemplate(coaFormElement.type)"></div>')}])}(),function(t){try{t=angular.module("simplicity")}catch(e){t=angular.module("simplicity",[])}t.run(["$templateCache",function(t){t.put("form-element/select.html",'<div class="form-group"><select class="form-control" id="{{coaFormElement.id}}" ng-init="coaFormElement.returnValue = coaFormElement.options[coaFormElement.defaultOptionIndex]" ng-model="coaFormElement.returnValue" ng-options="item.label for item in coaFormElement.options" style="width : 100%"></select></div>')}])}(),function(t){try{t=angular.module("simplicity")}catch(e){t=angular.module("simplicity",[])}t.run(["$templateCache",function(t){t.put("list/list.html",'<div class="col-xs-12"><div class="list-group"><a class="list-group-item list-item-panel"><address class="pull-left"><strong>{{locationProperties.address}}</strong><br>{{locationProperties.city}}, {{locationProperties.state}} {{locationProperties.zip}}</address><div ng-if="locationProperties.inTheCity" class="pull-right hidden-xs"><i class="fa fa-check-circle fa-2x text-success pull-left" style="margin-top : 10px"></i><h2 class="pull-left" style="margin-top : 7px">It\'s in the city!</h2></div><div ng-if="!locationProperties.inTheCity" class="pull-right hidden-xs"><i class="fa fa-times-circle fa-2x text-danger pull-left" style="margin-top : 10px"></i><h2 class="pull-left" style="margin-top : 7px">It\'s not in the city!</h2></div></a> <a ng-if="locationProperties.inTheCity" class="list-group-item list-item-panel visible-xs"><i class="fa fa-check-circle fa-2x text-success pull-left" style="margin-top : 10px"></i><h2 class="pull-left" style="margin-top : 7px">It\'s in the city!</h2></a> <a ng-if="!locationProperties.inTheCity" class="list-group-item list-item-panel visible-xs"><i class="fa fa-times-circle fa-2x text-danger pull-left" style="margin-top : 10px"></i><h2 class="pull-left" style="margin-top : 7px">It\'s not in the city!</h2></a> <a class="list-group-item list-item-panel" ng-click="getAnswer()" ng-repeat="question in questions" tabindex="{{$index + 1}}"><h4>{{question.question}}<i class="fa fa-chevron-right pull-right text-primary" style="margin-top: 8px"></i></h4></a> <a class="list-group-item list-item-panel" ng-show="more.show" ng-click="more.get()" tabindex="{{questions.length + 2}}"><h3 class="text-primary" style="text-align : center">More</h3></a></div></div>')}])}(),function(t){try{t=angular.module("simplicity")}catch(e){t=angular.module("simplicity",[])}t.run(["$templateCache",function(t){t.put("location/location.html","")}])}(),function(t){try{t=angular.module("simplicity")}catch(e){t=angular.module("simplicity",[])}t.run(["$templateCache",function(t){t.put("main/main.html",'<div class="col-md-6 col-md-offset-3"><br><div class="col-xs-12"><div class="col-xs-12"><div class="pull-left" ng-click="goHome();" ;="" style="cursor : pointer"><h1>SimpliCity</h1><h4>city data simplified</h4></div><img class="pull-right" style="margin-top: 5px" src="http://123graffitifree.com/images/citylogo-flatblack.png"></div><div class="col-xs-12"><br></div><form class="col-xs-12"><div class="input-group col-xs-12"><input type="text" class="form-control" placeholder="Enter a location" style="z-index: 0" ng-model="typedLocation" ng-keypress="getAddressCandidates(typedLocation)"> <span class="input-group-btn"><button class="btn btn-primary" ng-click="getLocation(typedLocation);" style="z-index: 0">Go!</button></span></div><p ng-show="errorMessage.show" class="text-danger">{{errorMessage.message}}</p><div class="list-group col-xs-12" style="position : absolute; z-index : 1000"><a ng-click="getThisLocation(address)" ng-repeat="address in addresses" class="list-group-item">{{address.attributes.address}}</a></div></form><div class="col-xs-12"><br></div></div><div class="col-xs-12 content" style="height : 400px"><div ui-view="" class="slide"></div></div></div>')}])}(),function(t){try{t=angular.module("simplicity")}catch(e){t=angular.module("simplicity",[])}t.run(["$templateCache",function(t){t.put("time/time.html",'<div><div class="form-group" ng-show="show"><select class="form-control" id="time" ng-init="timeValue = timeOptions[defaultOption]" ng-model="timeValue" ng-options="item.label for item in timeOptions" ng-change="onChangeTimeValue()" style="width : 100%"></select></div><div ui-view=""></div></div>')}])}(),app.controller("TimeCtrl",["$scope","$stateParams","$state","AppFact",function(t,e,i,l){if("current"===e.time)t.show=!1;else{t.show=!0,t.timeOptions=l.timeOptions(),console.log(t.timeOptions);for(var o=0;o<t.timeOptions.length;o++)t.timeOptions[o].value===e.time&&(console.log(o),t.defaultOption=o)}t.onChangeTimeValue=function(){console.log(t.timeValue),i.go("main.location.category.time.extent.filter.details",{time:t.timeValue.value})}}]);